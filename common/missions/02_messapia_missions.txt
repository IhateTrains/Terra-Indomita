messapia_missions = {
    header = "mission_image_generic_greek"
    icon = "cde_new_city_founded"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        primary_culture = messapian
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
        save_scope_as = mission_country_scope #Bcs also available to Apulia
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {}
    messapia_missions_task_1 = { # The Lucani War
        icon = "task_political"
        allow = {
            custom_tooltip = {
                #stephan you can put what you need here
                text = event_war_over_tt
                OR = {
                    has_global_variable = lucania_lost_war
                    has_global_variable = tarentum_lost_war
                }
            }
        }
        on_completion = {
            trigger_event = me_messapia.1
            show_as_tooltip = { 
                if = {
                    limit = {
                        has_global_variable = lucania_lost_war # you win
                    }
                    add_stability = 5
                    current_ruler = { # took the right decisions
                        add_martial = 1
                        add_charisma = 1
                        add_popularity = 25
                        add_character_experience = 8
                        add_gold = 500
                    }
                    current_heir = { # heir learns new stuff
                        add_martial = 1
                        add_charisma = 1
                        add_popularity = 25
                        add_character_experience = 3
                    }
                }
                if = {
                    limit = {
                        has_global_variable = tarentum_lost_war # you lose
                    }
                    # to recoup some of the losses
                    add_country_modifier = {
                        name = recovering_from_war_303
                        duration = 3650 # 10 years
                    }
                    current_ruler = {
                        add_popularity = -10
                        add_trait = cautious
                    }
                }
            }
        }
    }
    messapia_missions_task_2 = { # Pyrrhic Plans
        icon = "task_political"
        requires = { messapia_missions_task_1 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.2
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_3 = { # Acquisition of Apulia
        icon = "task_political"
        requires = { messapia_missions_task_1 messapia_missions_task_23 }
        allow = {
            owns_or_subject_owns_area = cannae_area
        }
        on_completion = {
            trigger_event = me_messapia.3
            show_as_tooltip = {
                custom_tooltip = assimilate_pops_messapia_tt
                hidden_effect = {
                    while = {
                        count = 15
                        random_owned_province = {
                            random_pops_in_prpvince = {
                                limit = {
                                    NOT = { pop_culture = ROOT.culture }
                                }
                                set_pop_culture = ROOT.culture
                            }
                        }
                    }
                }
            }
        }
    }
    messapia_missions_task_4 = { # Invasion of Italia
        icon = "task_political"
        requires = { messapia_missions_task_3 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.4
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_5 = { # Across the Adriatic
        icon = "task_political"
        requires = { messapia_missions_task_3 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.5
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_6 = { # Mission to Magna Graecia
        icon = "task_political"
        requires = { messapia_missions_task_3 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.6
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_7 = { # Laws and Litigations
        icon = "task_political"
        requires = { messapia_missions_task_16 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.7
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_8 = { # Greek Governance
        icon = "task_political"
        requires = { messapia_missions_task_7 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.8
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_9 = { # Italic Inquires
        icon = "task_political"
        requires = { messapia_missions_task_7 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.9
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_10 = { # Enlightened Illyrians
        icon = "task_political"
        requires = { messapia_missions_task_7 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.10
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_11 = { # Embrace the Wolf Cult
        icon = "task_political"
        requires = { messapia_missions_task_15 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.11
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_12 = { # Embelish the Zis Cult
        icon = "task_political"
        requires = { messapia_missions_task_15 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.12
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_13 = { # Encounter the Reitia Cult
        icon = "task_political"
        requires = { messapia_missions_task_15 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.13
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_14 = { # Magna Illyria
        icon = "task_political"
        requires = { messapia_missions_task_11 messapia_missions_task_12 messapia_missions_task_13 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.14
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_15 = { # Deus or Theos
        icon = "task_political"
        requires = { messapia_missions_task_16 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.15
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_16 = { # Adriatic Crossovers
        icon = "task_political"
        requires = { messapia_missions_task_1 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.16
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_17 = { # A Messapian Republic
        icon = "task_political"
        requires = { messapia_missions_task_8 messapia_missions_task_9 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.17
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_18 = { # King of the Messapii
        icon = "task_political"
        requires = { messapia_missions_task_9 messapia_missions_task_10 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.18
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_19 = { # Horde of Messapia
        icon = "task_political"
        requires = { messapia_missions_task_10 messapia_missions_task_11 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.19
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_20 = { # Magna Illyrians
        icon = "task_political"
        requires = { messapia_missions_task_14 messapia_missions_task_21 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.20
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_21 = {
        icon = "task_political"
        requires = { messapia_missions_task_17 messapia_missions_task_18 messapia_missions_task_19 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.21
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_22 = {
        icon = "task_political"
        allow = {
            owns_or_subject_owns_area = tarentum_area
        }
        requires = { messapia_missions_task_1 messapia_missions_task_23 }
        on_completion = {
            trigger_event = me_messapia.22
            show_as_tooltip = { # should be adjusted
                add_aggressive_expansion = -5
                add_treasury = 250
            }
        }
    }
    messapia_missions_task_23 = { # annex diplomatically the other messapian nation (apulia/messapia)
        icon = "task_political"
        allow = {
            trigger_if = { 
                limit = {
                    tag = MSP
                }
                hidden:c:APU = {
                    opinion = {
                        target = root
                        value >= 125
                    }
                }  
            }
            trigger_else_if = { 
                limit = {
                    tag = APU
                }
                hidden:c:MSP = {
                    opinion = {
                        target = root
                        value >= 125
                    }
                }  
            }
        }
        bypass = {
            is_subject = yes # first one to do the task will be overlord
        }
        on_completion = {
            trigger_event = me_messapia.23
            show_as_tooltip = {
                if = {
                    limit = {
                        tag = MSP
                    }
                    make_subject = {
                        target = c:APU
                        type = feudatory
                    }
                }
                else_if = {
                    limit = {
                        tag = APU
                    }
                    make_subject = {
                        target = c:MSP
                        type = feudatory
                    }
                }
                capital_scope = { 
                    create_state_pop = freemen
                    create_state_pop = freemen  
                }
            }
        }
    }
    messapia_missions_task_24 = {
        icon = "task_political"
        allow = {}
        on_completion = {
            trigger_event = me_messapia.24
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_25 = {
        icon = "task_political"
        allow = {}
        on_completion = {
            trigger_event = me_messapia.25
            show_as_tooltip = {

            }
        }
    }
}