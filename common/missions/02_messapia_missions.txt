messapia_missions = {
    header = "mission_image_generic_greek"
    icon = "cde_new_city_founded"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        primary_culture = messapian
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
        save_scope_as = mission_country_scope #Bcs also available to Apulia
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {}
    messapia_missions_task_1 = { # The Lucani War
        icon = "task_political"
        highlight = {
            scope:province = {
                OR = {
                    owner = c:SPA
                    owner = c:APU
                    owner = c:MSP
                    owner = c:LCA
                    owner = c:TAR
                }
            }
        }
        allow = {
            custom_tooltip = {
                #stephan you can put what you need here
                text = event_war_over_tt
                OR = {
                    has_global_variable = lucania_lost_war
                    has_global_variable = tarentum_lost_war
                }
            }
        }
        on_completion = {
            trigger_event = me_messapia.1
            show_as_tooltip = { 
                if = {
                    limit = {
                        has_global_variable = lucania_lost_war # you win
                    }
                    add_stability = 5
                    current_ruler = { # took the right decisions
                        add_martial = 1
                        add_charisma = 1
                        add_popularity = 25
                        add_character_experience = 8
                        add_gold = 500
                    }
                    current_heir = { # heir learns new stuff
                        add_martial = 1
                        add_charisma = 1
                        add_popularity = 25
                        add_character_experience = 3
                    }
                }
                if = {
                    limit = {
                        has_global_variable = tarentum_lost_war # you lose
                    }
                    # to recoup some of the losses
                    add_country_modifier = {
                        name = recovering_from_war_303
                        duration = 3650 # 10 years
                    }
                    current_ruler = {
                        add_popularity = -10
                        add_trait = cautious
                    }
                }
            }
        }
    }
    messapia_missions_task_2 = { # Pyrrhic Plans
        icon = "task_diplomatic"
        duration = 180
        highlight = {
            scope:province = {
                owner = c:EPI
            }
        }
        requires = { messapia_missions_task_1 }
        allow = {
            hidden:c:EPI = {
                alliance_with = root
            }
        }
        bypass = {
            c:EPI = { has_land = no }
        }
        on_start = {
            trigger_event = me_messapia.200
            show_as_tooltip = {
                custom_tooltip = pyrrhic_plans_1_tt
            }
        }
        on_completion = {
            trigger_event = me_messapia.2
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_3 = { # Acquisition of Apulia
        icon = "task_conquest"
        highlight = {
            scope:province = {
                is_in_area = cannae_area
            }
        }
        requires = { messapia_missions_task_1 messapia_missions_task_23 }
        allow = {
            owns_or_subject_owns_area = cannae_area
        }
        on_completion = {
            trigger_event = me_messapia.3
            show_as_tooltip = {
                custom_tooltip = assimilate_pops_messapia_tt
                mission_claim_region_effect = { REGION = magna_graecia_region }
                hidden_effect = {
                    while = {
                        count = 15
                        random_owned_province = {
                            random_pops_in_prpvince = {
                                limit = {
                                    NOT = { pop_culture = ROOT.culture }
                                }
                                set_pop_culture = ROOT.culture
                            }
                        }
                    }
                }
            }
        }
    }
    messapia_missions_task_4 = { # Invasion of Italia
        icon = "task_political"
        requires = { messapia_missions_task_3 }
        allow = {
            calc_true_if = {
                amount >= 3
                owns = 1713
                owns = 6
                owns = 1718
                owns = 35
                owns = 32
            }
        }
        highlight = {
            scope:province = {
                OR = {
                    province_id = 1713
                    province_id = 6
                    province_id = 1718
                    province_id = 35
                    province_id = 32
                }
            }
        }
        on_completion = {
            trigger_event = me_messapia.4
            show_as_tooltip = {
                add_political_influence = 50
                mission_claim_region_effect = { REGION = central_italy_region }
            }
        }
    }
    messapia_missions_task_5 = { # Across the Adriatic
        icon = "task_political"
        requires = { messapia_missions_task_3 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.5
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_6 = { # Mission to Magna Graecia
        icon = "task_political"
        requires = { messapia_missions_task_3 }
        allow = {
            calc_true_if = {
                amount >= 7
                owns = 78
                owns = 54
                owns = 80
                owns = 12
                owns = 75
                owns = 84
                owns = 52
                owns = 72
                owns = 73
                owns = 99
                owns = 82
            }
        }
        highlight = {
            scope:province = {
                OR = {
                    province_id = 78
                    province_id = 54
                    province_id = 80
                    province_id = 12
                    province_id = 75
                    province_id = 84
                    province_id = 52
                    province_id = 72
                    province_id = 73
                    province_id = 99
                    province_id = 82
                }
            }
        }
        on_completion = {
            trigger_event = me_messapia.6
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_7 = { # Laws and Litigations
        icon = "task_political"
        requires = { messapia_missions_task_16 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.7
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_8 = { # Greek Governance
        icon = "task_political"
        requires = { messapia_missions_task_7 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.8
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_9 = { # Italic Inquires
        icon = "task_political"
        requires = { messapia_missions_task_7 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.9
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_10 = { # Enlightened Illyrians
        icon = "task_political"
        requires = { messapia_missions_task_7 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.10
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_11 = { # Embrace the Wolf Cult
        icon = "task_artemis"
        highlight = {
            scope:province = {
                dominant_province_religion = illyrian_pantheon
            }
        }
        requires = { messapia_missions_task_15 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.11
            show_as_tooltip = {
                set_country_religion = illyrian_pantheon
                custom_tooltip = wolf_cult_tt
            }
        }
    }
    messapia_missions_task_12 = { # Embelish the Zis Cult
        icon = "task_zeus_cornucopia"
        highlight = {
            scope:province = {
                dominant_province_religion = roman_pantheon
            }
        }
        requires = { messapia_missions_task_15 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.12
            show_as_tooltip = {
                custom_tooltip = stay_hellenic_tt
                custom_tooltip = zis_cult_tt
            }
        }
    }
    messapia_missions_task_13 = { # Empower the Menzanas Cult
        icon = "task_heracles"
        highlight = {
            scope:province = {
                OR = {
                    province_id = 39
                    dominant_province_religion = italic_pantheon
                }
            }
        }
        requires = { messapia_missions_task_15 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.13
            show_as_tooltip = {
                set_country_religion = italic_pantheon
                custom_tooltip = menzanas_cult_tt
            }
        }
    }
    messapia_missions_task_14 = { # Faith in Messapia
        icon = "task_political"
        highlight = {
            scope:province = {
                OR = {
                    dominant_province_culture = messapian
                }
            }
        }
        requires = { messapia_missions_task_11 messapia_missions_task_12 messapia_missions_task_13 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.14
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_15 = { # Deus or Theos
        icon = "task_religion"
        requires = { messapia_missions_task_16 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.15
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_16 = { # Crossroads of the Adriatic
        icon = "task_religion"
        requires = { messapia_missions_task_1 }
        allow = {
        }
        on_completion = {
            trigger_event = me_messapia.16
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_17 = { # A Messapian Republic
        icon = "task_political"
        requires = { messapia_missions_task_8 messapia_missions_task_9 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.17
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_18 = { # King of the Messapii
        icon = "task_political"
        requires = { messapia_missions_task_9 messapia_missions_task_10 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.18
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_19 = { # Horde of Messapia
        icon = "task_political"
        requires = { messapia_missions_task_10 messapia_missions_task_11 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.19
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_20 = { # Magna Illyrians
        icon = "task_political"
        requires = { messapia_missions_task_14 messapia_missions_task_21 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.20
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_21 = {
        icon = "task_political"
        requires = { messapia_missions_task_17 messapia_missions_task_18 messapia_missions_task_19 }
        allow = {}
        on_completion = {
            trigger_event = me_messapia.21
            show_as_tooltip = {

            }
        }
    }
    messapia_missions_task_22 = { # Triumph Over Tarentum
        icon = "task_battle"
        highlight = {
            scope:province = {
                province_id = 56
            }
        }
        allow = {
            owns_or_subject_owns_area = tarentum_area
        }
        requires = { messapia_missions_task_1 messapia_missions_task_23 }
        on_completion = {
            trigger_event = me_messapia.22
            show_as_tooltip = { # should be adjusted
                add_aggressive_expansion = -5
                add_treasury = 250
            }
        }
    }
    messapia_missions_task_23 = { # Brothers By Blood
        icon = "task_happiness"
        highlight = {
            scope:province = {
                owner = c:APU
            }
        }
        allow = {
            trigger_if = { 
                limit = {
                    tag = MSP
                }
                hidden:c:APU = {
                    opinion = {
                        target = root
                        value >= 125
                    }
                }  
            }
            trigger_else_if = { 
                limit = {
                    tag = APU
                }
                hidden:c:MSP = {
                    opinion = {
                        target = root
                        value >= 125
                    }
                }  
            }
        }
        bypass = {
            is_subject = yes # first one to do the task will be overlord
        }
        on_completion = {
            trigger_event = me_messapia.23
            show_as_tooltip = {
                if = {
                    limit = {
                        tag = MSP
                    }
                    make_subject = {
                        target = c:APU
                        type = feudatory
                    }
                }
                else_if = {
                    limit = {
                        tag = APU
                    }
                    make_subject = {
                        target = c:MSP
                        type = feudatory
                    }
                }
                capital_scope = { 
                    create_state_pop = freemen
                    create_state_pop = freemen  
                }
            }
        }
    }
    messapia_missions_task_24 = { # Ruin Rome
        icon = "task_political"
        allow = {
            owns = 1
            c:ROM = {
                num_of_cities < 10
            }
        }
        highlight = {
            scope:province = {
                province_id = 1
            }
        }
        requires = {
            messapia_missions_task_4
        }
        on_completion = {
            trigger_event = me_messapia.24
            show_as_tooltip = {
                add_innovation = 2
                add_military_experience = 50
                current_ruler = {
                    add_nickname = NICKNAME_DESTROYER
                    hidden = {
                        if = {
                            limit = {
                                has_trait = tactically_inflexible
                            }
                            remove_trait = tactically_inflexible
                        }
                    }
                    add_trait = original_thinker
                    add_popularity = 25
                }
            }
        }
    }
    messapia_missions_task_25 = { # Seize Sicily
        icon = "task_political"
        requires = {
            messapia_missions_task_6
        }
        allow = {
            owns_or_subject_owns_area = syracuse_area
            owns_or_subject_owns_area = east_sicily_area
            owns_or_subject_owns_area = west_sicily_area
        }
        highlight = {
            scope:province = {
                OR = {
                    is_in_area = syracuse_area
                    is_in_area = east_sicily_area
                    is_in_area = west_sicily_area
                }
            }
        }
        on_completion = {
            trigger_event = me_messapia.25
            show_as_tooltip = {
                custom_tooltip = sicily_grain_tt
                p:84 = { # all of sicily gets it
                    add_permanent_province_modifier = {
                        name = sicilian_grain_messapia
                        duration = -1
                    }
                }
            }
        }
    }
}