tartessia2 = {
    header = "mission_image_generic_greek"
    icon = thrace_3

    repeatable = no
    chance = {
        factor = 5
    }
    ai_chance = {factor = 3}

    potential = {
        has_completed_mission = tartessia 
    	NOT = { has_variable = tartessia2_mission_cooldown_var }
    }

    abort = {
		ai_mission_back_out_trigger = yes
	}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = tartessia2_mission_cooldown_var
            days = 7300
        }
    }

    on_completion = {
        complete_mission_effect = yes
        add_2_free_province_investments = yes
    }

    tartessia2_mission_inv_1_task = { # An Iberian Metropolis
        icon = "task_happiness"

        highlight = {
			scope:province = {
				owner = root
                is_capital = yes
			}
        }

        requires = {tartessia2_mission_inv_13_task }

        allow = {
            treasury >= 300
            political_influence = 75
            hidden:capital_scope = {
				num_of_used_building_slots >= 10
                total_population >= 70
				trigger_if = {
					limit = { has_construction = yes }
					custom_tooltip = {
						text = province_has_no_construction_tooltip
						has_construction  = no
					}
				}
			}
		}

        on_completion = {
            capital_scope = {
                set_city_status = city_metropolis
			}
            trigger_event = me_greek_7_korkyra.1
            show_as_tooltip = {

            }
        }
    }

    tartessia2_mission_inv_2_task = { #Safe Behind Wooden Walls
        icon = "task_expansion"
        duration = 60

        highlight = {
			scope:province = {
				OR = {
					is_in_area = couneia_area
                    is_in_area = baetica_cordubensis_area
					is_in_area = turdulia_orientalis_area
                    is_in_area = oretania_area
                    is_in_area = malacita_area
                    is_in_area = bastetania_area
                    is_in_area = turdulia_occidentalis_area
                    is_in_area = turdetania_occidentalis_area
                    is_in_area = baetica_hispalensis_area
                    is_in_area = gaditanus_area
			    }
		    }
        }

        allow = {
            political_influence >= 50
        }

        on_completion = {
            add_political_influence = -50
            area:couneia_area = {
				add_provincial_claim_effect = yes
			}
            area:baetica_cordubensis_area = {
				add_provincial_claim_effect = yes
			}
            area:baetica_hispalensis_area = {
				add_provincial_claim_effect = yes
			}
            area:turdulia_orientalis_area = {
				add_provincial_claim_effect = yes
			}
            area:baetica_cordubensis_area = {
				add_provincial_claim_effect = yes
			}
            area:oretania_area = {
				add_provincial_claim_effect = yes
			}
            area:malacita_area = {
				add_provincial_claim_effect = yes
			}
            area:gaditanus_area = {
				add_provincial_claim_effect = yes
			}
            area:bastetania_area = {
				add_provincial_claim_effect = yes
			}
            area:turdulia_occidentalis_area = {
				add_provincial_claim_effect = yes
			}
            area:turdetania_occidentalis_area = {
				add_provincial_claim_effect = yes
			}
            trigger_event = me_greek_7_korkyra.2
            show_as_tooltip = {

            }
        }
    }
    tartessia2_mission_inv_3_task = { # Tartessian Mills
        icon = "task_calm"

        highlight = {
			scope:province = {
                owner = root
				is_capital = yes
			}
        }

        requires = {tartessia2_mission_inv_6_task }

        allow = {
            hidden:capital_scope = {
                num_of_workshop_building >= 2
                num_of_commerce_building >= 2
                free_building_slots >= 1  
            }
        }

        on_completion = {
            add_political_influence = 15
            add_research = {
                technology = civic_tech
                value = 10
            }
            capital_scope = {
                add_building_level = workshop_building
            }
            trigger_event = me_greek_7_korkyra.3
            show_as_tooltip = {

            }
        }
    }
    tartessia2_mission_inv_4_task = { # Lunging Towards Lusitania
        icon = "task_battle"
        requires = {tartessia2_mission_inv_2_task }
        duration = 60

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = couneia_area
                    is_in_area = turdulia_occidentalis_area
                    is_in_area = turdulia_orientalis_area
                    is_in_area = turdetania_occidentalis_area
                }
            }
        }

        allow = {
            owns_percent_of_area = {
                PROVINCE = "p:1337"
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:1420"
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:1449"
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:1415"
                PERCENT = "0.75"
            }
        }

        on_completion = {
            add_military_experience = 10
            custom_tooltip = tartessia_claims_lusitania_tt
            region:lusitania_region= {
                hidden_effect = {
                    every_region_province = {
                        add_claim = root
                    }
                }
            }
            trigger_event = me_greek_7_korkyra.4
            show_as_tooltip = {

            }
        }
    }

    tartessia2_mission_inv_5_task = { # Inquiries Into The Iberic Faith
        icon = "task_religion"
        requires = {tartessia2_mission_inv_2_task}
        duration = 90

        highlight = {
			scope:province = {
                owner = root
				is_capital = yes
			}
        }

        potential = {
			current_ruler = {
                NOT = { has_religion = carthaginian_pantheon }
            }
		}

        allow = {
            political_influence >= 50
            stability >= 60
            invention = happiness_for_wrong_group_modifier_inv_1
            custom_tooltip = {
                text = religious_piety_tt
                capital_scope.state = {
                    calc_true_if = {
                        amount >= 1   
                        state_improvement_religious_trigger = yes      
                    }
                }
            } 
        }

        on_completion = {
            add_political_influence = -50
            trigger_event = me_greek_7_korkyra.5
            show_as_tooltip = {

            }
        }
    }
    tartessia2_mission_inv_6_task = { #Restore The Mines Of Tharsis
        icon = "task_conquest"
        requires = {}

        icon = task_economical

		requires = {}

		highlight = {
			scope:province = {
				owner = root
				OR = {
					trade_goods = precious_metals
					trade_goods = iron
					trade_goods = base_metals
					trade_goods = stone
				}
			}
		}

		allow = {
			custom_tooltip = {
				text = have_mine_tartessia_tt
				any_owned_province = {
					count >= 3
					has_building = slave_mine_building
				}
			}
		}

		on_completion = {
			random_owned_province = {
                limit = { num_of_slave_mine_building >= 1 }
                add_province_modifier = {
                    name = mines_of_tharsis_turdetania_mod
                    duration = -1
                }
            }
			add_country_modifier = {
				name = tharsis_mines_iron_boom
				duration = 3650
			}
			trigger_event = me_tartessia.3
			}
    }

    tartessia2_mission_inv_7_task = { #Tartessian Foundry
        icon = "task_diplomatic"
        duration = 90
        requires = {tartessia2_mission_inv_3_task}

        highlight = {
			scope:province = {
                owner = root
				is_capital = yes
			}
        }

        allow = {
            hidden:capital_scope = {
                has_building = foundry_building
            }
        }

        on_completion = {
            add_country_modifier = {
                name = tartessian_foundry_building_modifier
                duration = 3650
            }
            trigger_event = me_greek_7_korkyra.7
            show_as_tooltip = {

            }
        }
    }

    tartessia2_mission_inv_8_task = { #Tartessian Coinage
        icon = "task_battle"
        requires = {tartessia2_mission_inv_6_task }

        highlight = {
			scope:province ={
				owner = root
				is_capital = yes
			}
		}

		allow = {
			capital_scope = {
				is_importing_trade_good = precious_metals
				civilization_value >= 35
				num_of_academy_building >= 1
				num_of_library_building >= 1
				num_of_used_building_slots >= 1      
			}
		}

		on_completion = {
			add_2_free_province_investments = yes
			current_ruler = {
				add_trait = scholar
			}
			capital_scope = {
				add_building_level = forum_building
				add_province_modifier = {
					name = turdetanian_coin_mint_mod
					duration = -1
				}
			}
			trigger_event = me_tartessia.8	
		}
    }
    tartessia2_mission_inv_9_task = { #Greek Trading Connections
        icon = "task_political"
       
        requires = {tartessia2_mission_inv_8_task}
        
        allow = {
			hidden:capital_scope = {
				has_city_status = yes
				num_of_commerce_building >= 3 
			}
			capital_scope.state = {
				calc_true_if = {
					amount >= 1   
					state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes    
				}
			}
		}
        
		on_completion = {
			capital_scope = {
				add_province_modifier = {
					name = greek_trade_connection_turdetania_mod
					duration = -1
				}
			}
			trigger_event = me_tartessia.7
		}
    }

    tartessia2_mission_inv_10_task = { # Cinnabar-Colored Cloth
        icon = "task_conquest"
        requires = {tartessia2_mission_inv_7_task tartessia2_mission_inv_15_task}

        highlight = {
			scope:province = {
				OR = {
                    province_id = 1406
                    province_id = 1439
                    province_id = 1444
                }
			}
        }

        allow = {
            p:1439 = {
                num_of_slave_mine_building >= 1
                total_population >= 10  
            }
            p:1406 = {
                num_of_latifundia_building >= 1
                total_population >= 10 
            }
            p:1444 = {
                num_of_latifundia_building >= 1
                total_population >= 10 
            }
        }

        on_completion = {
            create_country_treasure = {
                key = tartessian_cinnabar_robe_treasure
                icon = treasure_it_golden_cape_of_deceangli
                modifier = {
                    local_country_civilization_value = 5
                    local_happiness_for_same_religion_modifier = 0.05
                }
            }
            p:1439 = {
                add_permanent_province_modifier = {
                    name = tartessian_cinnabar_textiles_mod
                    duration = -1
                }
            }
            p:1406 = {
                add_permanent_province_modifier = {
                    name = tartessian_cinnabar_textiles_mod
                    duration = -1
                }
            }
            p:1444 = {
                add_permanent_province_modifier = {
                    name = tartessian_cinnabar_textiles_mod
                    duration = -1
                }
            }
            trigger_event = me_greek_7_korkyra.10
            show_as_tooltip = {

            }
        }
    }
    tartessia2_mission_inv_11_task = { #Tartessian Metalworks
        icon = "task_conquest"
        final = yes
        requires = {tartessia2_mission_inv_6_task }

        highlight = {
			scope:province = {
				owner = root
				OR = {
					trade_goods = iron
					trade_goods = base_metals
				}
			}
		}

        allow = {
            custom_tooltip = {
				text = tartessia2_onuba_iron_base_metals_svalue_tt
				tartessia_onuba_iron_base_metals_svalue >= 20
			}
        }

        on_completion = {
            add_country_modifier = {
                name = onuban_metal_production_boom_2
                duration = -1
            }
            trigger_event = me_greek_7_korkyra.11
        }
    }

    tartessia2_mission_inv_12_task = { #Carthaginian Contacts
        icon = "task_heracles"
        requires = {tartessia2_mission_inv_8_task}

        highlight = {
			scope:province = {
				province_id = 3061
			}
        }

        bypass = {
            c:CAR = {
                NOT = {	owns = 3061 }
            }
        }

		allow = {
			num_of_ships >= 20 
			hidden:p:3061.governor = {
				is_friend = root.current_ruler
			}
		}

		on_completion = {
			add_country_modifier = {
				name = carthaginian_turdetanian_connection_mod
				duration = 3650
			}
			trigger_event = me_tartessia.2

		}
    }
    tartessia2_mission_inv_13_task = { # A Cosmopolitan City
        icon = "task_economical"
        duration = 180

        requires = {tartessia2_mission_inv_9_task tartessia2_mission_inv_12_task}

        highlight = {
			scope:province = {
                owner = root
				is_capital = yes
			}
        }

        allow = {
            hidden:capital_scope = {
                has_building = forum_building
                num_of_theathre_building >= 1
            }
        }

        on_completion = {
            add_innovation = 1
            add_treasury = 100
            capital_scope = {
				while = {
					count = 1
					define_pop = {
						type = citizen
						culture = thracian
						religion = roman_pantheon
					}
				}
			}
            capital_scope = {
				while = {
					count = 1
					define_pop = {
						type = citizen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
				}
			}
            trigger_event = me_greek_7_korkyra.13
            show_as_tooltip = {
            }
        }
    }

    tartessia2_mission_inv_14_task = { # Iberian Gods
    icon = "task_political"
    duration = 60
    requires = {tartessia2_mission_inv_5_task}

    potential = {
        current_ruler = {
            NOT = { has_religion = carthaginian_pantheon }
        }
    }

    allow = {    
         current_ruler = {
            popularity >= 70
            zeal >= 7 
         }
    }

    on_completion = {
        trigger_event = me_tartessia.29
        show_as_tooltip = {

        }
    }
}

tartessia2_mission_inv_15_task = { #Turdetanian Armor
    icon = "task_expansion"
    
    requires = {tartessia2_mission_inv_11_task}

    highlight = {
        scope:province = {
            owner = root
            is_capital = yes
        }
    }

    allow = {
        military_experience >= 50
        hidden:capital_scope.state = {
            trade_good_surplus = {
                target = iron
                value >= 3
            }
        }
    }

    on_completion = { 
        trigger_event = me_tartessia.15
        show_as_tooltip = {
            add_military_experience = -50
            add_country_modifier = {
                name = turdetanian_warriors
                duration = -1
            }
        }
    }
}

tartessia2_mission_inv_16_task = { # Contesting Contestania
    icon = "task_expansion"
    duration = 60
    requires = {tartessia2_mission_inv_2_task}

    highlight = {
        scope:province = {
            OR = {
                is_in_area = turdulia_orientalis_area
                is_in_area = oretania_area
                is_in_area = bastetania_area
                is_in_area = baetica_cordubensis_area
            }
        }
    }

    allow = {    
        owns_percent_of_area = {
            PROVINCE = "p:1381"
            PERCENT = "0.75"
        }
        owns_percent_of_area = {
            PROVINCE = "p:1397"
            PERCENT = "0.75"
        }
    }
    
    on_completion = {
        add_country_modifier = {
            name = glorious_battle
            duration = 3650
        }
        custom_tooltip = tartessia_claims_contestania_tt
            region:contestania_region= {
                hidden_effect = {
                    every_region_province = {
                        add_claim = root
                    }
                }
            }
        trigger_event = me_greek_7_korkyra.16
        show_as_tooltip = {

        }
    }
}

tartessia2_mission_inv_17_task = { #Obtaining Olisipo
        icon = "task_diplomatic"
        duration = 90
        requires = {tartessia2_mission_inv_4_task}

        highlight = {
			scope:province = {
				province_id = 1319
			}
        }

        allow = {
            owns_or_subject_owns = 1319
            hidden:p:1319 = {
                has_city_status = yes
                num_of_port_building >= 2 
            }
        }

        on_completion = {
            p:1319 = {
                add_permanent_province_modifier = {
                    name = tartessia_olisipo_military_harbor_mod
                    duration = -1
                }
            }
            trigger_event = me_greek_7_korkyra.7
            show_as_tooltip = {

            }
        }
    }

tartessia2_mission_inv_18_task = { #Obtaining Olisipo
    icon = "task_expansion"
    requires = {tartessia2_mission_inv_17_task}

    highlight = {
        scope:province = {
            province_id = 1319
        }
    }

    allow = {
        owns_or_subject_owns = 1319
        custom_tooltip = {
            text = we_need_raid_on_neighbors_tradition
            has_military_bonus = celt_iberian_path_c_3
        }
        political_influence >= 15
        treasury >= 50
    }

    on_completion = {
        p:1319 = {
            add_permanent_province_modifier = {
                name = pirate_haven_modifier
                duration = -1
            }
        }
        add_country_modifier = {
            name = tartessian_pirate_traditions_mod
            duration = -1
        }
        trigger_event = me_greek_7_korkyra.7
        show_as_tooltip = {

        }
    }
}

}